import{f as N,u as W,g as X,h as Z,j as ee,t as le,i as se,k as A,l as x,m as e,n as te,p as ae,s as re,R as $,q as ie,v as oe,x as ce,y as ue,z as ne,A as M,B as I,C as de,D as he,E as me,F as ve,L as pe,G as ye,H as ge,I as fe,J as P,K as He,M as k}from"./app-D1CqrMdh.js";const be=["/DailyRoutine.html","/Fitness.html","/","/blog.html","/intro.html","/posts/2024-03-01-blog_example.html","/posts/2024-03-02-blog_example2.html","/apps/Applist.html","/apps/Chrome.html","/apps/design.html","/apps/toolbox.html","/deploy/CloudServices.html","/deploy/Cloudflare.html","/deploy/DNS.html","/deploy/GitHub.html","/deploy/MySQL.html","/deploy/Static.html","/deploy/VPS.html","/code/AutoHotkey.html","/code/Electron.html","/code/HTML.html","/code/Javascript.html","/code/Markdown.html","/code/Python.html","/code/","/code/Regex.html","/code/Vue.html","/family/Coupon.html","/family/Diet.html","/family/Life.html","/web/Comments.html","/web/VuePress.html","/web/docsify.html","/apps/topic/","/apps/topic/topic01.html","/apps/topic/topic02anytitle.html","/404.html","/posts/","/apps/","/deploy/","/family/","/web/","/category/","/category/%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/","/category/%E5%B7%A5%E5%85%B7/","/tag/","/tag/%E9%A1%B5%E9%9D%A2%E9%85%8D%E7%BD%AE/","/tag/%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/","/article/","/star/","/timeline/"],Ee="SLIMSEARCH_QUERY_HISTORY",g=P(Ee,[]),xe=()=>{const{queryHistoryCount:a}=k;return{enabled:a>0,queryHistories:g,addQueryHistory:c=>{g.value=Array.from(new Set([c,...g.value.slice(0,a-1)]))},removeQueryHistory:c=>{g.value=[...g.value.slice(0,c),...g.value.slice(c+1)]}}},L=a=>be[a.id]+("anchor"in a?`#${a.anchor}`:""),ke="SLIMSEARCH_RESULT_HISTORY",{resultHistoryCount:T}=k,f=P(ke,[]),we=()=>({enabled:T>0,resultHistories:f,addResultHistory:o=>{{const c={link:L(o),display:o.display};"header"in o&&(c.header=o.header),f.value=[c,...f.value.slice(0,T-1)]}},removeResultHistory:o=>{f.value=[...f.value.slice(0,o),...f.value.slice(o+1)]}}),Se=a=>{const{page:o,routeLocale:c}=de(),w=he(),r=A(0),H=x(()=>r.value>0),d=me([]);return ve(()=>{const{search:S,terminate:v}=pe(),b=ge(p=>{const{resultsFilter:C=t=>t,querySplitter:y,suggestionsFilter:q,...i}=w.value;p?(r.value+=1,S(p,c.value,i).then(t=>C(t,p,c.value,o.value)).then(t=>{r.value-=1,d.value=t}).catch(t=>{console.warn(t),r.value-=1,r.value||(d.value=[])})):d.value=[]},k.searchDelay-k.suggestDelay,{maxWait:5e3});ye([a,c],([p])=>b(p.join(" "))),fe(()=>{v()})}),{isSearching:H,results:d}};var De=N({name:"SearchResult",props:{queries:{type:Array,required:!0},isFocusing:Boolean},emits:["close","updateQuery"],setup(a,{emit:o}){const c=W(),w=X(),r=Z(ee),{addQueryHistory:H,queryHistories:d,removeQueryHistory:S}=xe(),{resultHistories:v,addResultHistory:b,removeResultHistory:p}=we(),C=le(a,"queries"),{results:y,isSearching:q}=Se(C),i=se({isQuery:!0,index:0}),t=A(0),h=A(0),F=x(()=>d.value.length>0||v.value.length>0),D=x(()=>y.value.length>0),R=x(()=>y.value[t.value]||null),_=()=>{const{isQuery:l,index:s}=i;s===0?(i.isQuery=!l,i.index=l?v.value.length-1:d.value.length-1):i.index=s-1},j=()=>{const{isQuery:l,index:s}=i;s===(l?d.value.length-1:v.value.length-1)?(i.isQuery=!l,i.index=0):i.index=s+1},U=()=>{t.value=t.value>0?t.value-1:y.value.length-1,h.value=R.value.contents.length-1},V=()=>{t.value=t.value<y.value.length-1?t.value+1:0,h.value=0},O=()=>{h.value<R.value.contents.length-1?h.value+=1:V()},Y=()=>{h.value>0?h.value-=1:U()},Q=l=>l.map(s=>He(s)?s:e(s[0],s[1])),G=l=>{if(l.type==="customField"){const s=ue[l.index]||"$content",[m,u=""]=ne(s)?s[w.value].split("$content"):s.split("$content");return l.display.map(n=>e("div",Q([m,...n,u])))}return l.display.map(s=>e("div",Q(s)))},E=()=>{t.value=0,h.value=0,o("updateQuery",""),o("close")},J=()=>e("div",{class:"slimsearch-records"},e("div",{class:"slimsearch-record"},[e("div",{class:"slimsearch-record-title"},r.value.queryHistory),e("ul",{class:"slimsearch-record-contents",role:"listbox"},d.value.map((l,s)=>{const m=i.isQuery&&i.index===s;return e("li",{class:["slimsearch-record-matches",{active:m}],role:"option","aria-selected":m,onClick:()=>{o("updateQuery",l)}},e("div",[e(M,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},l),e("button",{type:"button",class:"slimsearch-remove-icon",title:r.value.remove,"aria-label":r.value.remove,innerHTML:I,onClick:u=>{u.preventDefault(),u.stopPropagation(),S(s)}})]))}))])),z=()=>e("ul",{class:"slimsearch-records"},e("li",{class:"slimsearch-record"},[e("div",{class:"slimsearch-record-title"},r.value.resultHistory),e("ul",{class:"slimsearch-record-contents",role:"listbox"},v.value.map((l,s)=>{const m=!i.isQuery&&i.index===s;return e("li",{class:["slimsearch-record-matches",{active:m}],role:"option","aria-selected":m},e($,{to:l.link,onClick:()=>{E()}},()=>[e(M,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},[l.header?e("div",{class:"slimsearch-record-content-header"},l.header):null,e("div",l.display.map(u=>Q(u)).flat())]),e("button",{type:"button",class:"slimsearch-remove-icon",title:r.value.remove,"aria-label":r.value.remove,innerHTML:I,onClick:u=>{u.preventDefault(),u.stopPropagation(),p(s)}})]))}))]));return te("keydown",l=>{if(a.isFocusing){if(D.value){if(l.key==="ArrowUp")Y();else if(l.key==="ArrowDown")O();else if(l.key==="Enter"){const s=R.value.contents[h.value];H(a.queries.join(" ")),b(s),c.push(L(s)),E()}}else if(l.key==="ArrowUp")_();else if(l.key==="ArrowDown")j();else if(l.key==="Enter"){const{index:s}=i;i.isQuery?(l.preventDefault(),o("updateQuery",d.value[s])):(c.push(v.value[s].link),E())}}}),ae([t,h],()=>{document.querySelector(".slimsearch-record.active .slimsearch-record-matches.active")?.scrollIntoView(!1)},{flush:"post"}),()=>e("div",{id:"slimsearch-results",class:["slimsearch-result-wrapper",{empty:a.queries.length?!D.value:!F.value}]},a.queries.length?q.value?e(re,{hint:r.value.searching}):D.value?e("div",{class:"slimsearch-records",role:"listbox","aria-labeledby":"slimsearch-label"},y.value.map(({title:l,contents:s},m)=>{const u=t.value===m;return e("div",{class:["slimsearch-record",{active:u}],role:"group","aria-selected":u},[e("div",{class:"slimsearch-record-title"},l||r.value.defaultTitle),e("ul",{class:"slimsearch-record-contents"},s.map((n,K)=>{const B=u&&h.value===K;return e("li",{class:["slimsearch-record-matches",{active:B}],role:"option","aria-selected":B},e($,{to:L(n),onClick:()=>{H(a.queries.join(" ")),b(n),E()}},()=>[n.type==="text"?null:e(n.type==="title"?ie:n.type==="heading"?oe:ce,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},[n.type==="text"&&n.header?e("div",{class:"slimsearch-record-content-header"},n.header):null,e("div",G(n))])]))}))])})):r.value.emptyResult:F.value?[J(),z()]:r.value.emptyHistory)}});export{De as default};
