"use strict";(self.webpackChunklearn_data=self.webpackChunklearn_data||[]).push([[7032],{7032:(t,s,i)=>{i.r(s),i.d(s,{HLSProvider:()=>b});var e=i(8327),h=i(4126),n=i(8734),r=i(8080),a=i(6450),o=i(6817),d=i(7651),c=i(4844),l=i(4729);class u{constructor(t,s){this.m=t,this.b=s,this.g=null,this.nd=null,this.od={},this.pd=new Set,this.yk=-1}get instance(){return this.g}setup(t){const{streamType:s}=this.b.$state,i=(0,r.p)(s).includes("live"),e=(0,r.p)(s).includes("ll-");this.g=new t({lowLatencyMode:e,backBufferLength:e?4:i?8:void 0,renderTextTracksNatively:!1,...this.od});const h=this.Sg.bind(this);for(const s of Object.values(t.Events))this.g.on(s,h);this.g.on(t.Events.ERROR,this.U.bind(this));for(const t of this.pd)t(this.g);this.b.player.dispatch("hls-instance",{detail:this.g}),this.g.attachMedia(this.m),this.g.on(t.Events.FRAG_LOADING,this.Bk.bind(this)),this.g.on(t.Events.AUDIO_TRACK_SWITCHED,this.Tg.bind(this)),this.g.on(t.Events.LEVEL_SWITCHED,this.Ug.bind(this)),this.g.on(t.Events.LEVEL_LOADED,this.Vg.bind(this)),this.g.on(t.Events.NON_NATIVE_TEXT_TRACKS_FOUND,this.Wg.bind(this)),this.g.on(t.Events.CUES_PARSED,this.Xg.bind(this)),this.b.qualities[a.Q.Za]=this.Yg.bind(this),(0,r.l)(this.b.qualities,"change",this.Yo.bind(this)),(0,r.l)(this.b.audioTracks,"change",this.Zo.bind(this)),this.nd=(0,r.g)(this._g.bind(this))}Wo(t,s){return new r.D((t=>(0,r.Q)(t))(t),{detail:s})}_g(){if(!this.b.$state.live())return;const t=new c.R(this.$g.bind(this));return t.Bb(),t.ra.bind(t)}$g(){this.b.$state.liveSyncPosition.set(this.g?.liveSyncPosition??1/0)}Sg(t,s){this.b.player?.dispatch(this.Wo(t,s))}Wg(t,s){const i=this.Wo(t,s);let e=-1;for(let t=0;t<s.tracks.length;t++){const h=s.tracks[t],n=h.subtitleTrack??h.closedCaptions,r=new o.T({id:`hls-${h.kind}-${t}`,src:n?.url,label:h.label,language:n?.lang,kind:h.kind,default:h.default});r[o.a.M]=2,r[o.a.Ua]=()=>{"showing"===r.mode?(this.g.subtitleTrack=t,e=t):e===t&&(this.g.subtitleTrack=-1,e=-1)},this.b.textTracks.add(r,i)}}Xg(t,s){const i=this.g?.subtitleTrack,e=this.b.textTracks.getById(`hls-${s.type}-${i}`);if(!e)return;const h=this.Wo(t,s);for(const t of s.cues)t.positionAlign="auto",e.addCue(t,h)}Tg(t,s){const i=this.b.audioTracks[s.id];if(i){const e=this.Wo(t,s);this.b.audioTracks[d.L.pa](i,!0,e)}}Ug(t,s){const i=this.b.qualities[s.level];if(i){const e=this.Wo(t,s);this.b.qualities[d.L.pa](i,!0,e)}}Vg(t,s){if(this.b.$state.canPlay())return;const{type:i,live:e,totalduration:h,targetduration:n}=s.details,o=this.Wo(t,s);this.b.delegate.c("stream-type-change",e?"EVENT"===i&&Number.isFinite(h)&&n>=10?"live:dvr":"live":"on-demand",o),this.b.delegate.c("duration-change",h,o);const c=this.g.media;-1===this.g.currentLevel&&this.b.qualities[a.Q.Ya](!0,o);for(const t of this.g.audioTracks){const s={id:t.id.toString(),label:t.name,language:t.lang||"",kind:"main"};this.b.audioTracks[d.L.oa](s,o)}for(const t of this.g.levels){const s={id:t.id?.toString()??t.height+"p",width:t.width,height:t.height,codec:t.codecSet,bitrate:t.bitrate};this.b.qualities[d.L.oa](s,o)}c.dispatchEvent(new r.D("canplay",{trigger:o}))}U(t,s){if(s.fatal)switch(s.type){case"networkError":this.Ck(s.error);break;case"mediaError":this.g?.recoverMediaError();break;default:this.Ak(s.error)}}Bk(){this.yk>=0&&this.zk()}Ck(t){this.zk(),this.g?.startLoad(),this.yk=window.setTimeout((()=>{this.yk=-1,this.Ak(t)}),5e3)}zk(){clearTimeout(this.yk),this.yk=-1}Ak(t){this.b.delegate.c("error",{message:t.message,code:1,error:t})}Yg(){this.g&&(this.g.currentLevel=-1)}Yo(){const{qualities:t}=this.b;this.g&&!t.auto&&(this.g[t.switch+"Level"]=t.selectedIndex,h.I&&(this.m.currentTime=this.m.currentTime))}Zo(){const{audioTracks:t}=this.b;this.g&&this.g.audioTrack!==t.selectedIndex&&(this.g.audioTrack=t.selectedIndex)}Dk(t){this.zk(),(0,r.i)(t.src)&&this.g?.loadSource(t.src)}ah(){this.zk(),this.g?.destroy(),this.g=null,this.nd?.(),this.nd=null}}class g{constructor(t,s,i){this.W=t,this.b=s,this.Ca=i,this.bh()}async bh(){const t={onLoadStart:this.Ea.bind(this),onLoaded:this.qd.bind(this),onLoadError:this.ch.bind(this)};let s=await async function(t,s={}){if((0,r.i)(t)){s.onLoadStart?.();try{if(await(0,e.l)(t),!(0,r.w)(window.Hls))throw Error("");const i=window.Hls;return s.onLoaded?.(i),i}catch(t){s.onLoadError?.(t)}}}(this.W,t);if((0,r.h)(s)&&!(0,r.i)(this.W)&&(s=await async function(t,s={}){if(!(0,r.h)(t)){if(s.onLoadStart?.(),t.prototype&&t.prototype!==Function)return s.onLoaded?.(t),t;try{const i=(await t())?.default;if(!i||!i.isSupported)throw Error("");return s.onLoaded?.(i),i}catch(t){s.onLoadError?.(t)}}}(this.W,t)),!s)return null;if(!s.isSupported()){const t="[vidstack] `hls.js` is not supported in this environment";return this.b.player.dispatch(new r.D("hls-unsupported")),this.b.delegate.c("error",{message:t,code:4}),null}return s}Ea(){this.b.player.dispatch(new r.D("hls-lib-load-start"))}qd(t){this.b.player.dispatch(new r.D("hls-lib-loaded",{detail:t})),this.Ca(t)}ch(t){const s=(0,l.c)(t);this.b.player.dispatch(new r.D("hls-lib-load-error",{detail:s})),this.b.delegate.c("error",{message:s.message,code:4,error:s})}}class b extends n.VideoProvider{constructor(){super(...arguments),this.$$PROVIDER_TYPE="HLS",this.Xe=null,this.d=new u(this.video,this.b),this.Gb="https://cdn.jsdelivr.net/npm/hls.js@^1.5.0/dist/hls.min.js"}get ctor(){return this.Xe}get instance(){return this.d.instance}static{this.supported=(0,h.s)()}get type(){return"hls"}get canLiveSync(){return!0}get config(){return this.d.od}set config(t){this.d.od=t}get library(){return this.Gb}set library(t){this.Gb=t}preconnect(){(0,r.i)(this.Gb)&&(0,e.p)(this.Gb)}setup(){super.setup(),new g(this.Gb,this.b,(t=>{this.Xe=t,this.d.setup(t),this.b.delegate.c("provider-setup",this);const s=(0,r.p)(this.b.$state.source);s&&this.loadSource(s)}))}async loadSource(t,s){(0,r.i)(t.src)?(this.a.preload=s||"",this.yn(t,"application/x-mpegurl"),this.d.Dk(t),this.V=t):this.Bn()}onInstance(t){const s=this.d.instance;return s&&t(s),this.d.pd.add(t),()=>this.d.pd.delete(t)}destroy(){this.d.ah()}}}}]);