"use strict";(self.webpackChunklearn_data=self.webpackChunklearn_data||[]).push([[5777],{5777:(t,i,s)=>{s.r(i),s.d(i,{DASHProvider:()=>b});var e=s(8327),a=s(4126),n=s(8734),h=s(8080),o=s(6450),d=s(6817),r=s(7651),c=s(4844),l=s(4729);class u{constructor(t,i){this.m=t,this.b=i,this.g=null,this.nd=null,this.od={},this.pd=new Set,this.Xo=null,this._o={},this.yk=-1}get instance(){return this.g}setup(t){this.g=t().create();const i=this.So.bind(this);for(const s of Object.values(t.events))this.g.on(s,i);this.g.on(t.events.ERROR,this.U.bind(this));for(const t of this.pd)t(this.g);this.b.player.dispatch("dash-instance",{detail:this.g}),this.g.initialize(this.m,void 0,!1),this.g.updateSettings({streaming:{text:{defaultEnabled:!1,dispatchForManualRendering:!0},buffer:{fastSwitchEnabled:!0}},...this.od}),this.g.on(t.events.FRAGMENT_LOADING_STARTED,this.bp.bind(this)),this.g.on(t.events.FRAGMENT_LOADING_COMPLETED,this.cp.bind(this)),this.g.on(t.events.MANIFEST_LOADED,this.Uo.bind(this)),this.g.on(t.events.QUALITY_CHANGE_RENDERED,this.fb.bind(this)),this.g.on(t.events.TEXT_TRACKS_ADDED,this.dp.bind(this)),this.g.on(t.events.TRACK_CHANGE_RENDERED,this._d.bind(this)),this.b.qualities[o.Q.Za]=this.Yg.bind(this),(0,h.l)(this.b.qualities,"change",this.Yo.bind(this)),(0,h.l)(this.b.audioTracks,"change",this.Zo.bind(this)),this.nd=(0,h.g)(this._g.bind(this))}Wo(t){return new h.D((i=t.type,`dash-${(0,h.Q)(i)}`),{detail:t});var i}_g(){if(!this.b.$state.live())return;const t=new c.R(this.$g.bind(this));return t.Bb(),t.ra.bind(t)}$g(){if(!this.g)return;const t=this.g.duration()-this.g.time();this.b.$state.liveSyncPosition.set(isNaN(t)?1/0:t)}So(t){this.b.player?.dispatch(this.Wo(t))}ep(t){const i=this.Xo?.[d.a.T],s=(i?.track).cues;if(!i||!s)return;const e=this.Xo.id,a=this._o[e]??0,n=this.Wo(t);for(let t=a;t<s.length;t++){const i=s[t];i.positionAlign||(i.positionAlign="auto"),this.Xo.addCue(i,n)}this._o[e]=s.length}dp(t){if(!this.g)return;const i=t.tracks,s=[...this.m.textTracks].filter((t=>"manualMode"in t)),e=this.Wo(t);for(let t=0;t<s.length;t++){const a=i[t],n=s[t],h=`dash-${a.kind}-${t}`,o=new d.T({id:h,label:a?.label??a.labels.find((t=>t.text))?.text??a?.lang??void 0,language:a.lang??void 0,kind:a.kind,default:a.defaultTrack});o[d.a.T]={managed:!0,track:n},o[d.a.M]=2,o[d.a.Ua]=()=>{this.g&&("showing"===o.mode?(this.g.setTextTrack(t),this.Xo=o):(this.g.setTextTrack(-1),this.Xo=null))},this.b.textTracks.add(o,e)}}_d(t){const{mediaType:i,newMediaInfo:s}=t;if("audio"===i){const i=this.b.audioTracks.getById(`dash-audio-${s.index}`);if(i){const s=this.Wo(t);this.b.audioTracks[r.L.pa](i,!0,s)}}}fb(t){if("video"!==t.mediaType)return;const i=this.b.qualities[t.newQuality];if(i){const s=this.Wo(t);this.b.qualities[r.L.pa](i,!0,s)}}Uo(t){if(this.b.$state.canPlay()||!this.g)return;const{type:i,mediaPresentationDuration:s}=t.data,e=this.Wo(t);this.b.delegate.c("stream-type-change","static"!==i?"live":"on-demand",e),this.b.delegate.c("duration-change",s,e),this.b.qualities[o.Q.Ya](!0,e);const n=this.g.getVideoElement(),d=this.g.getTracksForTypeFromManifest("video",t.data),c=[...new Set(d.map((t=>t.mimeType)))].find((t=>t&&(0,a.c)(n,t))),l=d.filter((t=>c===t.mimeType))[0];let u=this.g.getTracksForTypeFromManifest("audio",t.data);const g=[...new Set(u.map((t=>t.mimeType)))].find((t=>t&&(0,a.t)(n,t)));if(u=u.filter((t=>g===t.mimeType)),l.bitrateList.forEach(((t,i)=>{const s={id:t.id?.toString()??`dash-bitrate-${i}`,width:t.width??0,height:t.height??0,bitrate:t.bandwidth??0,codec:l.codec,index:i};this.b.qualities[r.L.oa](s,e)})),(0,h.j)(l.index)){const t=this.b.qualities[l.index];t&&this.b.qualities[r.L.pa](t,!0,e)}u.forEach(((t,i)=>{const s={id:`dash-audio-${t?.index}`,label:t.label??t.lang??"",language:t.lang??"",kind:"main",mimeType:t.mimeType,codec:t.codec,index:i};this.b.audioTracks[r.L.oa](s,e)})),n.dispatchEvent(new h.D("canplay",{trigger:e}))}U(t){const{type:i,error:s}=t;27===s.code?this.Ck(s):this.Ak(s)}bp(){this.yk>=0&&this.zk()}cp(t){"text"===t.mediaType&&requestAnimationFrame(this.ep.bind(this,t))}Ck(t){this.zk(),this.g?.play(),this.yk=window.setTimeout((()=>{this.yk=-1,this.Ak(t)}),5e3)}zk(){clearTimeout(this.yk),this.yk=-1}Ak(t){this.b.delegate.c("error",{message:t.message??"",code:1,error:t})}Yg(){this.Ro("video",!0);const{qualities:t}=this.b;this.g?.setQualityFor("video",t.selectedIndex,!0)}Ro(t,i){this.g?.updateSettings({streaming:{abr:{autoSwitchBitrate:{[t]:i}}}})}Yo(){const{qualities:t}=this.b;this.g&&!t.auto&&t.selected&&(this.Ro("video",!1),this.g.setQualityFor("video",t.selectedIndex,"current"===t.switch),a.I&&(this.m.currentTime=this.m.currentTime))}Zo(){if(!this.g)return;const{audioTracks:t}=this.b,i=this.g.getTracksFor("audio").find((i=>t.selected&&t.selected.id===`dash-audio-${i.index}`));i&&this.g.setCurrentTrack(i)}H(){this.zk(),this.Xo=null,this._o={}}loadSource(t){this.H(),(0,h.i)(t.src)&&this.g?.attachSource(t.src)}destroy(){this.H(),this.g?.destroy(),this.g=null,this.nd?.(),this.nd=null}}class g{constructor(t,i,s){this.W=t,this.b=i,this.Ca=s,this.bh()}async bh(){const t={onLoadStart:this.Ea.bind(this),onLoaded:this.qd.bind(this),onLoadError:this.ch.bind(this)};let i=await async function(t,i={}){if((0,h.i)(t)){i.onLoadStart?.();try{if(await(0,e.l)(t),!(0,h.w)(window.dashjs.MediaPlayer))throw Error("");const s=window.dashjs.MediaPlayer;return i.onLoaded?.(s),s}catch(t){i.onLoadError?.(t)}}}(this.W,t);if((0,h.h)(i)&&!(0,h.i)(this.W)&&(i=await async function(t,i={}){if(!(0,h.h)(t)){if(i.onLoadStart?.(),t.prototype&&t.prototype!==Function)return i.onLoaded?.(t),t;try{const s=(await t())?.default;if(!s)throw Error("");return i.onLoaded?.(s),s}catch(t){i.onLoadError?.(t)}}}(this.W,t)),!i)return null;if(!window.dashjs.supportsMediaSource()){const t="[vidstack] `dash.js` is not supported in this environment";return this.b.player.dispatch(new h.D("dash-unsupported")),this.b.delegate.c("error",{message:t,code:4}),null}return i}Ea(){this.b.player.dispatch(new h.D("dash-lib-load-start"))}qd(t){this.b.player.dispatch(new h.D("dash-lib-loaded",{detail:t})),this.Ca(t)}ch(t){const i=(0,l.c)(t);this.b.player.dispatch(new h.D("dash-lib-load-error",{detail:i})),this.b.delegate.c("error",{message:i.message,code:4,error:i})}}class b extends n.VideoProvider{constructor(){super(...arguments),this.$$PROVIDER_TYPE="DASH",this.Xe=null,this.d=new u(this.video,this.b),this.Gb="https://cdn.jsdelivr.net/npm/dashjs@4.7.4/dist/dash.all.min.js"}get ctor(){return this.Xe}get instance(){return this.d.instance}static{this.supported=(0,a.u)()}get type(){return"dash"}get canLiveSync(){return!0}get config(){return this.d.od}set config(t){this.d.od=t}get library(){return this.Gb}set library(t){this.Gb=t}preconnect(){(0,h.i)(this.Gb)&&(0,e.p)(this.Gb)}setup(){super.setup(),new g(this.Gb,this.b,(t=>{this.Xe=t,this.d.setup(t),this.b.delegate.c("provider-setup",this);const i=(0,h.p)(this.b.$state.source);i&&this.loadSource(i)}))}async loadSource(t,i){(0,h.i)(t.src)?(this.a.preload=i||"",this.yn(t,"application/x-mpegurl"),this.d.loadSource(t),this.V=t):this.Bn()}onInstance(t){const i=this.d.instance;return i&&t(i),this.d.pd.add(t),()=>this.d.pd.delete(t)}destroy(){this.d.destroy()}}}}]);