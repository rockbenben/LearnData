import{ap as p,aq as u,ar as o,as as b,o as l,at as g,au as n,l as c,al as f}from"./vidstack-Q8NlvF8c-fDaPONmZ.js";import{H as P}from"./vidstack-html-zXLYKqrJ.js";import"./app-D6wkk8fd.js";import"./vidstack-WmYumZve-qMTdtjyS.js";class k{constructor(t,e){this.$a=t,this.F=e,t.textTracks.onaddtrack=this.Jb.bind(this),l(this.ih.bind(this))}Jb(t){const e=t.track;if(!e||m(this.$a,e))return;const i=new g({id:e.id,kind:e.kind,label:e.label,language:e.language,type:"vtt"});i[n._b]={track:e},i[n.Sb]=2,i[n.Mb]=!0;let s=0;const h=d=>{if(e.cues)for(let a=s;a<e.cues.length;a++)i.addCue(e.cues[a],d),s++};h(t),e.oncuechange=h,this.F.textTracks.add(i,t),i.setMode(e.mode,t)}ih(){var t;this.$a.textTracks.onaddtrack=null;for(const e of this.F.textTracks){const i=(t=e[n._b])==null?void 0:t.track;i!=null&&i.oncuechange&&(i.oncuechange=null)}}}function m(r,t){return Array.from(r.children).find(e=>e.track===t)}class ${constructor(t,e){this.wb=(i,s)=>{this.B.delegate.A("picture-in-picture-change",i,s)},this.$a=t,this.B=e,c(this.$a,"enterpictureinpicture",this.jh.bind(this)),c(this.$a,"leavepictureinpicture",this.kh.bind(this))}get active(){return document.pictureInPictureElement===this.$a}get supported(){return o(this.$a)}async enter(){return this.$a.requestPictureInPicture()}exit(){return document.exitPictureInPicture()}jh(t){this.wb(!0,t)}kh(t){this.wb(!1,t)}}class T{constructor(t,e){this.Wb="inline",this.$a=t,this.B=e,c(this.$a,"webkitpresentationmodechanged",this.fc.bind(this))}get nh(){return u(this.$a)}async mh(t){this.Wb!==t&&this.$a.webkitSetPresentationMode(t)}fc(t){var i;const e=this.Wb;this.Wb=this.$a.webkitPresentationMode,(i=this.B.player)==null||i.dispatch(new f("video-presentation-change",{detail:this.Wb,trigger:t})),["fullscreen","picture-in-picture"].forEach(s=>{(this.Wb===s||e===s)&&this.B.delegate.A(`${s}-change`,this.Wb===s,t)})}}class w{constructor(t){this.lh=t}get active(){return this.lh.Wb==="fullscreen"}get supported(){return this.lh.nh}async enter(){this.lh.mh("fullscreen")}async exit(){this.lh.mh("inline")}}class x{constructor(t){this.lh=t}get active(){return this.lh.Wb==="picture-in-picture"}get supported(){return this.lh.nh}async enter(){this.lh.mh("picture-in-picture")}async exit(){this.lh.mh("inline")}}class W extends P{constructor(t,e){super(t),this.$$PROVIDER_TYPE="VIDEO",p(()=>{if(u(t)){const i=new T(t,e);this.fullscreen=new w(i),this.pictureInPicture=new x(i)}else o(t)&&(this.pictureInPicture=new $(t,e))},this.scope)}get type(){return"video"}setup(t){super.setup(t),b(this.video)&&new k(this.video,t),t.textRenderers.E(this.video),l(()=>{t.textRenderers.E(null)}),this.type==="video"&&t.delegate.A("provider-setup",this)}get video(){return this.B}}export{W as VideoProvider};
