import{ad as o,o as n,s as u,ae as l,k as c,af as B,e as f,l as e,ag as m,ah as p,ai as g,aj as b,ak as d,al as k,am as h}from"./vidstack-Q8NlvF8c-5YvUhBho.js";import{R as A}from"./vidstack-WmYumZve-ggsB-tiO.js";class y{constructor(t,i){this.eb=B(),this.th=!1,this.uh=!1,this.vh=!1,this.pa=new A(this.ua.bind(this)),this.yh=void 0,this.Nh=void 0,this.Dc=t,this.F=i,this.zh(),f(this.Ah.bind(this)),n(this.ih.bind(this))}get B(){return this.Dc.media}get A(){return this.F.delegate.A}ih(){this.uh=!1,this.vh=!1,this.pa.Ma(),this.eb.empty()}ua(){const t=this.B.currentTime;this.F.$state.currentTime()!==t&&this.sh(t)}zh(){this.rh("loadstart",this.Fg),this.rh("abort",this.xh),this.rh("emptied",this.Bh),this.rh("error",this.Ia)}Ch(){this.uh||(this.eb.add(this.rh("loadeddata",this.Dh),this.rh("loadedmetadata",this.Eh),this.rh("canplay",this.fe),this.rh("canplaythrough",this.Fh),this.rh("durationchange",this.Gh),this.rh("play",this.Aa),this.rh("progress",this.Q),this.rh("stalled",this.Hh),this.rh("suspend",this.Ih)),this.uh=!0)}Jh(){this.vh||(this.eb.add(this.rh("pause",this._),this.rh("playing",this.Kh),this.rh("ratechange",this.Lh),this.rh("seeked",this.R),this.rh("seeking",this.Mh),this.rh("ended",this.ba),this.rh("volumechange",this.qa),this.rh("waiting",this.Fa)),this.vh=!0)}rh(t,i){return e(this.B,t,i.bind(this))}Oh(t){}sh(t,i){const s={currentTime:Math.min(t,this.F.$state.seekableEnd()),played:this.B.played};this.A("time-update",s,i)}Fg(t){if(this.B.networkState===3){this.xh(t);return}this.Ch(),this.A("load-start",void 0,t)}xh(t){this.A("abort",void 0,t)}Bh(){this.A("emptied",void 0,event)}Dh(t){this.A("loaded-data",void 0,t)}Eh(t){this.Jh(),this.A("volume-change",{volume:this.B.volume,muted:this.B.muted},t),this.A("loaded-metadata",void 0,t),m&&p(this.F.$state.source())&&this.F.delegate.ga(this.wh(),t)}wh(){return{provider:g(this.F.$provider),duration:this.B.duration,buffered:this.B.buffered,seekable:this.B.seekable}}Aa(t){this.F.$state.canPlay&&this.A("play",void 0,t)}_(t){this.B.readyState===1&&!this.th||(this.th=!1,this.pa.Ma(),this.A("pause",void 0,t))}fe(t){this.F.delegate.ga(this.wh(),t)}Fh(t){this.F.$state.started()||this.A("can-play-through",this.wh(),t)}Kh(t){this.th=!1,this.A("playing",void 0,t),this.pa.Ja()}Hh(t){this.A("stalled",void 0,t),this.B.readyState<3&&(this.th=!0,this.A("waiting",void 0,t))}Fa(t){this.B.readyState<3&&(this.th=!0,this.A("waiting",void 0,t))}ba(t){this.pa.Ma(),this.sh(this.B.duration,t),this.A("end",void 0,t),this.F.$state.loop()&&b(this.B.controls)&&(this.B.controls=!1)}Ah(){this.F.$state.paused()&&e(this.B,"timeupdate",this.$.bind(this))}$(t){this.sh(this.B.currentTime,t)}Gh(t){this.F.$state.ended()&&this.sh(this.B.duration,t),this.A("duration-change",this.B.duration,t)}qa(t){const i={volume:this.B.volume,muted:this.B.muted};this.A("volume-change",i,t)}R(t){this.sh(this.B.currentTime,t),this.A("seeked",this.B.currentTime,t),Math.trunc(this.B.currentTime)===Math.trunc(this.B.duration)&&d(this.B.duration)>d(this.B.currentTime)&&(this.sh(this.B.duration,t),this.B.ended||this.F.player.dispatch(new k("media-play-request",{trigger:t})))}Mh(t){this.A("seeking",this.B.currentTime,t)}Q(t){const i={buffered:this.B.buffered,seekable:this.B.seekable};this.A("progress",i,t)}Ih(t){this.A("suspend",void 0,t)}Lh(t){this.A("rate-change",this.B.playbackRate,t)}Ia(t){const i=this.B.error;if(!i)return;const s={message:i.message,code:i.code,mediaError:i};this.A("error",s,t)}}class F{constructor(t,i){this.Dc=t,this.F=i,this.Ph.onaddtrack=this.Rh.bind(this),this.Ph.onremovetrack=this.Sh.bind(this),this.Ph.onchange=this.Th.bind(this),e(this.F.audioTracks,"change",this.Uh.bind(this))}get Ph(){return this.Dc.media.audioTracks}Rh(t){const i=t.track;if(i.label==="")return;const s={id:i.id+"",label:i.label,language:i.language,kind:i.kind,selected:!1};this.F.audioTracks[h.h](s,t),i.enabled&&(s.selected=!0)}Sh(t){const i=this.F.audioTracks.getById(t.track.id);i&&this.F.audioTracks[h.f](i,t)}Th(t){let i=this.Qh();if(!i)return;const s=this.F.audioTracks.getById(i.id);s&&this.F.audioTracks[h.Ga](s,!0,t)}Qh(){return Array.from(this.Ph).find(t=>t.enabled)}Uh(t){const{current:i}=t.detail;if(!i)return;const s=this.Ph.getTrackById(i.id);if(s){const r=this.Qh();r&&(r.enabled=!1),s.enabled=!0}}}class S{constructor(t){this.scope=o(),this.C=null,this.B=t}setup(t){new y(this,t),"audioTracks"in this.media&&new F(this,t),n(()=>{this.B.setAttribute("src",""),this.B.load()})}get type(){return""}get media(){return this.B}get currentSrc(){return this.C}setPlaybackRate(t){this.B.playbackRate=t}async play(){return this.B.play()}async pause(){return this.B.pause()}setMuted(t){this.B.muted=t}setVolume(t){this.B.volume=t}setCurrentTime(t){this.B.currentTime=t}setPlaysinline(t){u(this.B,"playsinline",t)}async loadSource({src:t,type:i},s){this.B.preload=s||"",l(t)?this.B.srcObject=t:(this.B.srcObject=null,this.B.src=c(t)?t:window.URL.createObjectURL(t)),this.B.load(),this.C={src:t,type:i}}}export{S as H};
